<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Backbone-Associations - Tutorials</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Support associations/relations in Backbone.js">
    <meta name="author" content="Dhruva Ray">
    <meta name="keywords"
          content="Backbone, relational, associations, association, nested, associated, model, cyclic graph, qualified event paths, relational, relations">


    <link href="./assets/css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
        body {
            padding-top: 60px;
            padding-bottom: 40px;
        }

        section {
            padding-top: 40px;
        }

        section > .page-header,
        section > .lead {
            color: #5a5a5a;
        }

        section > ul li {
            margin-bottom: 5px;
        }
    </style>
    <link href="./assets/css/bootstrap-responsive.css" rel="stylesheet">
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-41921363-1', 'dhruvaray.github.io');
        ga('send', 'pageview');

    </script>

</head>

<body data-spy="scroll" data-target=".bs-docs-sidebar">

<div class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="brand" href="index.html">Backbone Associations</a>

            <div class="nav-collapse collapse">
                <ul class="nav">
                    <li><a href="./index.html">Home</a></li>
                    <li><a href="./getting-started.html">Get Started</a></li>
                    <li><a href="./specify-associations.html">Specify Associations</a></li>
                    <li><a href="./events.html">Events</a></li>
                    <li class="active"><a href="./tutorial.html" class="active">Tutorials</a></li>
                    <li><a href="./recipes.html">Recipes</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="container">

<div class="alert alert-block alert-info fade in">
    Try out our recently released Firebug extension - <a href="http://dhruvaray.github.io/spa-eye/">Backbone Eye</a> : Understand Backbone application behavior without debugging JavaScript!
</div>

<!-- Example row of columns -->
<div class="row">
<div class="span3">
    <div class="well sidebar-nav bs-docs-sidebar affix">
        <ul id="side-menu" class="nav nav-list navbar bs-docs-sidenav">
            <li class="nav-header">Tutorial</li>
            <li class="active"><a href="#sa-example" class="active">Example Hierarchy</a></li>
            <li><a href="#sa-dh">Hierarchy Definition</a></li>
            <li><a href="#sa-ch">Hierarchy Instantiation</a></li>
            <li><a href="#sa-ce">Change events</a></li>
            <li><a href="#sa-are">Add & Remove events</a></li>
            <li><a href="#sa-ns">Next steps</a></li>
        </ul>
    </div>
</div>
<div class="span9">

<section id="sa-example">
    <h4>Example Hierarchy</h4>
    <hr/>
    <div class="well well-large">
        The tutorial uses the example below to walk through the process of defining associations, creating object
        instances and being able to tune-in to various kinds of events which are thrown due to updates in the object
        graph.
        <img src="./docs/img/cd_example.png"/>
        This image was generated via code! Check it out <a
            href="https://github.com/dhruvaray/backbone-associations/blob/master/docs/cd_example.tex">here</a>
    </div>
</section>
<section id="sa-dh">
    <h4>Hierarchy Definition using Backbone-associations</h4>
    <hr/>
    <div class="well well-large">
        This section demonstrates how to convert the example into an AssociatedModels representation.
<pre class="prettyprint">

//Convert the associations into model definitions.
var Location = Backbone.AssociatedModel.extend({
    defaults:{
        add1:"",
        add2:null,
        zip:"",
        state:""
    }
});

var Project = Backbone.AssociatedModel.extend({
    relations:[
        {
            type:Backbone.Many,
            key:'locations',
            relatedModel:Location
        }
    ],
    defaults:{
        name:"",
        number:0,
        locations:[]
    }
});


var Department = Backbone.AssociatedModel.extend({
    relations:[
        {
            type:Backbone.Many,
            key:'controls',
            relatedModel:Project
        },
        {
            type:Backbone.Many,
            key:'locations',
            relatedModel:Location
        }
    ],
    defaults:{
        name:'',
        locations:[],
        number:-1,
        controls:[]
    }
});

var Dependent = Backbone.AssociatedModel.extend({
    validate:function (attr) {
        return (attr.sex && attr.sex != "M" && attr.sex != "F") ? "invalid sex value" : undefined;
    },
    defaults:{
        fname:'',
        lname:'',
        sex:'F', //{F,M}
        age:0,
        relationship:'S' //Values {C=Child, P=Parents, S=Spouse}
    }
});

var Employee = Backbone.AssociatedModel.extend({
    relations:[
        {
            type:Backbone.One,
            key:'works_for',
            relatedModel:Department
        },
        {
            type:Backbone.Many,
            key:'dependents',
            relatedModel:Dependent
        },
        {
            type:Backbone.One,
            key:'manager',
            relatedModel:'Employee'
        }
    ],
    validate:function (attr) {
        return (attr.sex && attr.sex != "M" && attr.sex != "F") ? "invalid sex value" : undefined;
    },
    defaults:{
        sex:'M', //{F,M}
        age:0,
        fname:"",
        lname:"",
        works_for:{},
        dependents:[],
        manager:null
    }
});

</pre>
    </div>
</section>
<section id="sa-ch">
    <h4>Hierarchy Instantiation</h4>
    <hr/>
    <div class="well well-large">
        This section sets-up instances and associations with the model definitions and associations created in the
        earlier section.
<pre class="prettyprint">
emp = new Employee({
    fname:"John",
    lname:"Smith",
    age:21,
    sex:"M"
});

child1 = new Dependent({
    fname:"Jane",
    lname:"Smith",
    sex:"F",
    relationship:"C"

});

child2 = new Dependent({
    fname:"Barbara",
    lname:"Ruth",
    sex:"F",
    relationship:"C"

});

parent1 = new Dependent({
    fname:"Edgar",
    lname:"Smith",
    sex:"M",
    relationship:"P"

});

loc1 = new Location({
    add1:"P.O Box 3899",
    zip:"94404",
    state:"CA"

});

loc2 = new Location({
    add1:"P.O Box 4899",
    zip:"95502",
    state:"CA"
});

project1 = new Project({
    name:"Project X",
    number:"2"
});

project2 = new Project({
    name:"Project Y",
    number:"2"
});

project2.get("locations").add(loc2);
project1.get("locations").add(loc1);

dept1 = new Department({
    name:"R&D",
    number:"23"
});

dept1.set({locations:[loc1, loc2]});
dept1.set({controls:[project1, project2]});

emp.set({"dependents":[child1, parent1]});

</pre>
    </div>
</section>
<section id="sa-ce">
<h4>Update related examples</h4>
<hr/>
<div class="well well-large">
In this section, we look at scenarios where various kind of updates can be listen-ed to at higher levels.
<ul>
    <li>
        <h5>Assign Associated Model instances to other properties</h5>
        Backbone-associations allows for assignment of previously instantiated model instances to another model's
        attributes.
                <pre class="prettyprint">
emp.on('change', function () {
    console.log("Fired emp > change...");
    //emp.hasChanged() === true;
    //emp.hasChanged("works_for") === true;
});
emp.on('change:works_for', function () {
    console.log("Fired emp > change:works_for...");
    var changed = emp.changedAttributes();
    //changed['works_for'].toJSON() equals emp.get("works_for").toJSON()
    //emp.previousAttributes()['works_for'].get('name') === "");
    //emp.previousAttributes()['works_for'].get('number') === -1;
    //emp.previousAttributes()['works_for'].get('locations').length === 0;
    //emp.previousAttributes()['works_for'].get('controls').length === 0;
});

emp.set({works_for:dept1});
//Console log
//Fired emp > change:works_for...
//Fired emp > change...
                </pre>
    </li>
    <li>
        <h5>Listen to updates of attributes in nested AssociatedModel instances</h5> The example shows all the
        possible ways to listen to changes at various levels within the object hierarchy.
                <pre class="prettyprint">
emp.get('works_for').on('change', function () {
    console.log("Fired emp.works_for > change...");
    //emp.get("works_for").hasChanged() === true;
    //emp.get("works_for").previousa-tributes()["name"] === "R&D";
});
emp.get('works_for').on('change:name', function () {
    console.log("Fired emp.works_for > change:name...");

});

emp.on('change:works_for.name', function () {
    console.log("Fired emp > change:works_for.name...");
    //emp.get("works_for").hasChanged() === true;
    //emp.hasChanged() === true;
    //emp.hasChanged("works_for") === true;
    //emp.changedAttributes()['works_for'].toJSON() equals emp.get("works_for").toJSON();
    //emp.get("works_for").previous-attributes()["name"] === "R&D";
    //emp.get("works_for").previous("name") === "R&D";
});

emp.on('change:works_for', function () {
    console.log("Fired emp > change:works_for...");
    //emp.hasChanged());
    //emp.hasChanged("works_for"));
    //emp.changedAttributes()['works_for'].toJSON() equals emp.get("works_for").toJSON();
    //emp.previous-attributes().works_for.name === "R&D";
});

emp.on('nested-change', function () {
    console.log("Fired emp > nested-change...");
});

emp.get('works_for').set({name:"Marketing"});

//Console log
// @ emp.get('works_for') level
//Fired emp.works_for > change:name
//Fired emp.works_for > change...

//@ emp level
//Fired emp > change:works_for.name...
//Fired emp > change:works_for...
//Fired emp > nested-change...
                </pre>
    </li>
    <li>
        <h5>Listen to updates to an item within a collection of AssociatedModels</h5>The example shows all the
        possible ways to listen to changes at various levels within the object hierarchy.
                <pre class="prettyprint">
//The actual set operation
emp.get('works_for').get("locations").at(0).set('zip', 94403);
                </pre>
        A simple update like the one above can be listened to at various levels. See the examples below.
                <pre class="prettyprint">
//Listen in @ emp.works_for.locations[0]. Should receive regular backbone events
emp.get('works_for').get('locations').at(0).on('change:zip', function () {
    console.log("Fired emp.works_for.locations[0] > change:zip...");
});

emp.get('works_for').get('locations').at(0).on('change', function () {
    console.log("Fired emp.works_for.locations[0] > change...");
});

//@ emp.get('works_for').get('locations') level
//Fired emp.works_for.locations[0] > change...
//Fired emp.works_for.locations[0].zip > change...
                </pre>
                <pre class="prettyprint">
//Listen in @ emp.works_for level
emp.get('works_for').on('change:locations[0].zip', function () {
    console.log("Fired emp.works_for > change:locations[0].zip...");
});

emp.get('works_for').on('change:locations[0]', function () {
    console.log("Fired emp.works_for > change:locations[0]...");
});

emp.get('works_for').on('change:controls[0].locations[0].zip', function () {
    console.log("Fired emp.works_for > change:controls[0].locations[0].zip...");
});

emp.get('works_for').on('change:controls[0].locations[0]', function () {
    console.log("Fired emp.works_for > change:controls[0].locations[0]...");
});

emp.get('works_for').on('change:locations[*]', function () {
    console.log("Fired emp.works_for > change:locations[*]...");
});

emp.get('works_for').on('change:controls[*].locations[*]', function () {
    console.log("Fired emp.works_for > change:controls[*].locations[*]...");
});

emp.get('works_for').on('change:controls[*].locations[*].zip', function () {
    console.log("Fired emp.works_for > change:works_for.controls[*].locations[*].zip...");
});

emp.get('works_for').on('nested-change', function () {
    if (arguments[0] == "controls[0].locations[0]")
        console.log("Fired emp.works_for > nested-change:controls[0].locations[0]...");
    if (arguments[0] == "locations[0]")
        console.log("Fired emp.works_for > nested-change:locations[0]...");
});

//Console log
//@ emp.get('works_for') level
//Fired emp.works_for > change:controls[0].locations[0]...
//Fired emp.works_for > change:controls[0].locations[0].zip...
//Fired emp.works_for > change:locations[0]...
//Fired emp.works_for > change:locations[0].zip...
//Fired emp.works_for > nested-change:controls[0].locations[0]...
//Fired emp.works_for > nested-change:locations[0]...
//Fired emp.works_for > change:locations[*]...
//Fired emp.works_for > change:controls[*].locations[*]...
//Fired emp.works_for > change:works_for.controls[*].locations[*].zip...
                </pre>
                <pre class="prettyprint">
//Listen in @ emp level
emp.on('change:works_for.locations[0].zip', function () {
    console.log("Fired emp > change:works_for.locations[0].zip...");
});

emp.on('change:works_for.locations[0]', function () {
    console.log("Fired emp > change:works_for.locations[0]...");
});

emp.on('change:works_for.controls[0].locations[0].zip', function () {
    console.log("Fired emp > change:works_for.controls[0].locations[0].zip...");
});

emp.on('change:works_for.controls[0].locations[0]', function () {
    console.log("Fired emp > change:works_for.controls[0].locations[0]...");
});

emp.on('nested-change', function () {
if (arguments[0] == "works_for.controls[0].locations[0]")
    console.log("Fired emp > nested-change:works_for.controls[0].locations[0]...");
if (arguments[0] == "works_for.locations[0]")
    console.log("Fired emp > nested-change:works_for.locations[0]...");
});

emp.on('change:works_for.locations[*]', function () {
    console.log("Fired emp > change:works_for.locations[*]...");
});

emp.on('change:works_for.controls[*].locations[*]', function () {
    console.log("Fired emp > change:works_for.controls[*].locations[*]...");
});

emp.on('change:works_for.controls[*].locations[*].zip', function () {
    console.log("Fired emp > change:works_for.controls[*].locations[*].zip...");
});
//@ emp level
//Fired emp > change:works_for.controls[0].locations[0]...
//Fired emp > change:works_for.controls[0].locations[0].zip...
//Fired emp > change:works_for.locations[0]...
//Fired emp > change:works_for.locations[0].zip...
//Fired emp > nested-change:works_for.controls[0].locations[0]...
//Fired emp > nested-change:works_for.locations[0]...
//Fired emp > change:works_for.locations[*]...
//Fired emp > change:works_for.controls[*].locations[*].zip...
//Fired emp > change:works_for.controls[*].locations[*]...
            </pre>


        </pre>
    </li>
</ul>
</div>
</section>
<section id="sa-are">
    <h4>Add-Remove-Reset related examples</h4>
    <hr/>

    <div class="well well-large">
        Similar to the update example in the earlier section, grandparents (and others) can listen-in to add, remove,
        reset, sort and destroy operations on any grand-children at any level of depth.
                <pre class="prettyprint">
emp.on('add:dependents', function () {
    console.log("Fired emp > add:dependents...");
});
emp.on('remove:dependents', function () {
    console.log("Fired emp > remove:dependents...");
});
emp.on('reset:dependents', function () {
    console.log("Fired emp > reset:dependents...");
});

emp.get('dependents').on('add', function () {
    console.log("Fired emp.dependents add...");
});
emp.get('dependents').on('remove', function () {
    console.log("Fired emp.dependents remove...");
});
emp.get('dependents').on('reset', function () {
    console.log("Fired emp.dependents reset...");
});

emp.get("dependents").add(child2);
emp.get("dependents").remove([child1]);
emp.get("dependents").reset();

//Console log
//Fired emp.dependents add...
//Fired Fired emp.dependents remove...
//Fired emp.dependents reset...

//Fired emp > add:dependents...
//Fired emp > remove:dependents...
//Fired emp > reset:dependents...
                </pre>
    </div>
</section>

<section id="sa-ns">
    <h4>Next Steps</h4>
    <hr/>
    <div class="well well-large">
        See real-world <a href="./recipes.html">recipes</a> contributed by users.
    </div>

</section>
</div>

</div>

</div>
<!-- Placed at the end of the document so the pages load faster -->
<script src="http:////ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js?skin=sunburst"></script>
<script src="./assets/js/bootstrap.js"></script>
<script src="./assets/js/ba.js"></script>

</body>
</html>
